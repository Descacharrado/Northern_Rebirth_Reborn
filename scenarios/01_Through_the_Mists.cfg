#textdomain wesnoth-nrr

[scenario]
    id=01_Through_the_Mists
    name= _ "Through the Mists"
    map_file=01_Through_the_Mists.map
    {TURNS 18 14 12}
    next_scenario=02_Ancient_Catacombs
    victory_when_enemies_defeated=no
    {XP_MODIFIER_NRR}

    # constant night
    {MIDNIGHT}

    # maybe a custom music playlist?
    {DEFAULT_MUSIC_PLAYLIST}

    [side]
        side=1
        controller=human
        {CHARACTER_STATS_TALLIN}
        # will change to knalgan flag in S4
        {FLAG_VARIANT6 ragged}
        team_name="player"
        user_team_name= _ "Slaves"
        shroud=yes
        fog=yes
        share_vision=all
        {NO_ECONOMY}
        {NO_RECRUITMENT}
    [/side]

    # slavers - Orc
    [side]
        side=2
        controller=ai
        canrecruit=yes
        type="Orcish Ruler"
        # todo add generic name/ID
        id="Orcish Slave Master"
        generate_name=yes
        team_name="orcs"
        user_team_name= _ "Clan White Fang"
        shroud=yes
        fog=yes
        share_vision=all
        # color dependent on what clan this orc is from
        color=white
        {GOLD 80 120 150}
        {INCOME 2 6 10}
        [modifications]
            {TRAIT_STRONG}
            {TRAIT_SLOW}
        [/modifications]
        recruit="Goblin Spearman, Goblin Impaler, Orcish Grunt, Orcish Archer, Wolf Rider, Young Ogre, Ogre, Orcish Warrior"

        village_gold=0
        village_support=2
        # set up AI
        {CHAOTIC_AI_PARAMS}
        [ai]
            # dont bother with a single slave
            [goal]
                [criteria]
                    side=1
                [/criteria]
                value=0.005
            [/goal]
            # go after invader
            [goal]
                [criteria]
                    side=3
                [/criteria]
                value=0.95
            [/goal]
            [goal]
                [criteria]
                    side=4
                [/criteria]
                value=0.05
            [/goal]
        [/ai]
    [/side]

    {STARTING_VILLAGES_ALL 2}

    {LIMIT_CONTEMPORANEOUS_RECRUITS 2 "Orcish Warrior" {ON_DIFFICULTY 1 1 2}}
    {LIMIT_CONTEMPORANEOUS_RECRUITS 2 "Ogre" {ON_DIFFICULTY 1 1 2}}
    {LIMIT_CONTEMPORANEOUS_RECRUITS 2 "Goblin Impaler" {ON_DIFFICULTY 2 3 5}}

    # invaders - Drakes and Saurians
    [side]
        side=3
        controller=ai
        canrecruit=yes
        type="Drake Blademaster"
        # todo add generic name/ID
        id="Invader Leader"
        generate_name=yes
        color=darkred
        {GOLD 120 180 200}
        {INCOME 2 6 10}
        team_name="invaders"
        user_team_name= _ "Drakes"
        shroud=yes
        fog=yes
        share_vision=all
        [modifications]
            {TRAIT_RESILIENT}
            {TRAIT_FEARLESS}
        [/modifications]
        recruit="Drake Burner, Drake Flare, Drake Fighter, Drake Clasher, Drake Glider, Saurian Skirmisher, Saurian Ambusher, Saurian Spearthrower, Saurian Augur"
        village_gold=0
        village_support=2
        # set up AI
        {CHAOTIC_AI_PARAMS}
        [ai]
            # dont bother with a single slave
            [goal]
                [criteria]
                    side=1
                [/criteria]
                value=0.005
            [/goal]
            # go after big prey
            [goal]
                [criteria]
                    side=2
                [/criteria]
                value=0.95
            [/goal]
            [goal]
                [criteria]
                    side=4
                [/criteria]
                value=0.05
            [/goal]
        [/ai]
    [/side]

    # panicked villagers side
    [side]
        side=4
        controller=ai
        no_leader=yes
        color=black
        team_name="player"
        user_team_name= _ "Slaves"
        {NO_ECONOMY}
        {HIDDEN_TEAM}
        {NO_RECRUITMENT}
        {LAWFUL_AI_PARAMS}
        [ai]
            village_value=0
            [avoid]
                terrain=*^V*
            [/avoid]
        [/ai]
    [/side]

    # for leadership (that is if AI ever learns to value it)
    {LIMIT_CONTEMPORANEOUS_RECRUITS 3 "Drake Flare" 1}
    {LIMIT_CONTEMPORANEOUS_RECRUITS 3 "Saurian Ambusher" {ON_DIFFICULTY 2 3 3}}
    {LIMIT_CONTEMPORANEOUS_RECRUITS 3 "Saurian Spearthrower" {ON_DIFFICULTY 1 1 2}}

    [event]
        name=prestart

        # objectives
        [objectives]
            side=1
            silent=no
            [objective]
                description= _ "Escape to safety (1,32)"
                condition="win"
            [/objective]
            [objective]
                description= _ "Death of Tallin"
                condition="lose"
            [/objective]
            {TURNS_RUN_OUT}
            # players are braindead to skip message text
            # but they read these notes
            [note]
                description= _ "No unit recruitment available"
            [/note]
            [note]
                description= _ "You should avoid combat and escape"
            [/note]
            [note]
                description= _ "You have no weapons available"
            [/note]
            # you have no idea how necessary this is
            [note]
                description= _ "The purple XP bar does not mean any special AMLA here"
            [/note]
            
            [note]
                description= _ "You can wake up slaves by capturing villages"
            [/note]
        [/objectives]

        # place units

        # side 2
        {SCATTER_UNITS {ON_DIFFICULTY 20 24 30} ("Goblin Rouser, Goblin Impaler, Orcish Grunt, Orcish Archer, Wolf Rider, Young Ogre, Ogre, Orcish Warrior, Orcish Assassin, Orcish Slayer") 3 (
            x = 2-28,13-23,2-22
            y = 10-22,2-10,22-32

            [not]
                [filter]
                [/filter]
            [/not]

            [not]
                [filter_adjacent_location]
                    [filter]
                    [/filter]
                [/filter_adjacent_location]
            [/not]
        ) (
            side=2
            generate_name=yes
            random_traits=yes
            ai_special=guardian
            upkeep=0
        )}
        # side 3
        {SCATTER_UNITS {ON_DIFFICULTY 20 24 30} ("Drake Burner, Drake Flare, Drake Fighter, Drake Clasher, Drake Glider, Saurian Skirmisher, Saurian Ambusher, Saurian Spearthrower, Saurian Augur") 3 (
            x = 2-28,13-23,2-22
            y = 10-22,2-10,22-32

            [not]
                [filter]
                [/filter]
            [/not]

            [not]
                [filter_adjacent_location]
                    [filter]
                    [/filter]
                [/filter_adjacent_location]
            [/not]
        ) (
            side=3
            generate_name=yes
            random_traits=yes
            ai_special=guardian
            upkeep=0
        )}

        {LOYAL_UNIT 2 "Orcish Warrior"   5 29}{GUARDIAN}
        {LOYAL_UNIT 2 "Orcish Slayer"  12 30}{GUARDIAN}
        {LOYAL_UNIT 2 "Orcish Warrior"  19 30}{GUARDIAN}
        {LOYAL_UNIT 2 "Orcish Slayer"   8 22}{GUARDIAN}
        {LOYAL_UNIT 2 "Orcish Warrior"  14 24}{GUARDIAN}
        {LOYAL_UNIT 2 "Orcish Crossbowman"  18 14}{GUARDIAN}
        {LOYAL_UNIT 2 "Orcish Warrior"   5 15}{GUARDIAN}
        {LOYAL_UNIT 2 "Orcish Slayer"  17  9}{GUARDIAN}
        {LOYAL_UNIT 2 "Orcish Warrior"  27 14}{GUARDIAN}
        {LOYAL_UNIT 2 "Orcish Slayer"  20  6}{GUARDIAN}

        {LOYAL_UNIT 3 "Saurian Oracle"   5 29}{GUARDIAN}
        {LOYAL_UNIT 3 "Drake Flare"  12 30}{GUARDIAN}
        {LOYAL_UNIT 3 "Drake Warrior"  19 30}{GUARDIAN}
        {LOYAL_UNIT 3 "Sky Drake"   8 22}{GUARDIAN}
        {LOYAL_UNIT 3 "Saurian Ambusher"  14 24}{GUARDIAN}
        {LOYAL_UNIT 3 "Saurian Ambusher"  18 14}{GUARDIAN}
        {LOYAL_UNIT 3 "Saurian Spearthrower"   5 15}{GUARDIAN}
        {LOYAL_UNIT 3 "Drake Warrior"  17  9}{GUARDIAN}
        {LOYAL_UNIT 3 "Drake Clasher"  27 14}{GUARDIAN}
        {LOYAL_UNIT 3 "Drake Arbiter"  20  6}{GUARDIAN}

        # optimise
        [micro_ai]
            side=2
            ai_type=simple_attack
            action=add

            ca_score=110000
            [filter]
                side=2
                canrecruit=no
            [/filter]
            [filter_second]
                side=3,4
            [/filter_second]
        [/micro_ai]

        [micro_ai]
            side=3
            ai_type=simple_attack
            action=add

            ca_score=110000
            [filter]
                side=3
                canrecruit=no
            [/filter]
            [filter_second]
                side=2,4
            [/filter_second]
        [/micro_ai]
    [/event]

    [event]
        name="moveto"
        first_time_only=yes
        [filter]
            x,y=1,32
            id="Tallin"
        [/filter]

        # some dialogue

        # add macro here
        [endlevel]
            result=victory
        [/endlevel]
    [/event]

    [event]
        name="time over"

        # some dialogue here?

        {ENDLEVEL_DEFEAT}
    [/event]

    [event]
        name="capture"
        first_time_only=yes
        [filter]
            side=1
        [/filter]

        # some dialogue on Tallin trying to tell his fellow slaves
    [/event]

    # if Tallin captures a village, he will wake up slaves
    [event]
        name="capture"
        first_time_only=no
        [filter]
            side=1
        [/filter]

        #ifdef EASY
        {RANDOM_RECRUIT 4 ("Peasant,Woodsman,Ruffian") $x1 $y1}
        {RANDOM_RECRUIT 4 ("Peasant,Woodsman,Ruffian") $x1 $y1}
        #else
        {RANDOM_RECRUIT 4 ("Peasant,Woodsman,Ruffian") $x1 $y1}
        #endif
    [/event]

    {DESTROY_VILLAGE_MECHANIC 3}

    {LEADER_JOINS_BATTLE 2}
    {LEADER_JOINS_BATTLE 3}

    {TALLIN_DEATH_EVENT}
[/scenario]
