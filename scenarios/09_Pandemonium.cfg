#textdomain wesnoth-nrr

[scenario]
    id=09_Pandemonium
    name= _ "Pandemonium"
    map_file=09_Pandemonium.map
    {TURNS 50 48 46}
    next_scenario=09x_In_the_Hall_of_Forges
    victory_when_enemies_defeated=yes
    {XP_MODIFIER_NRR}
    {NRR_LOAD_RESOURCES}
    {ENABLE_DWARVISH_RUNESMITH}
    {NRR_ENCHANTING_SYSTEM}

    {DEFAULT_SCHEDULE_SECOND_WATCH}
    {DEFAULT_MUSIC_PLAYLIST}

    [side]
        side=1
        controller=human
        {CHARACTER_STATS_TALLIN}
        {FLAG_VARIANT knalgan}
        team_name="player"
        user_team_name= _ "Knalgan Alliance"
        {GOLD 150 120 70}
        recruit={KNALGAN_ALLIANCE_RECRUIT_LIST_FULL}
    [/side]

    {STARTING_VILLAGES 1 6}

    # Zorfu Side
    [side]
        side=2
        controller=ai
        no_leader=yes
        persistent=yes
        save_id=Zorfu
        {WITHERVEIN_ORCS}
        {FLAG_VARIANT6 ragged}
        team_name="player"
        user_team_name= _ "Withervein Orcs"

        {GOLD 150 120 70}

        recruit={ORC_CLAN_WITHERVEIN_RECRUIT_LIST}
        {CHAOTIC_AI_PARAMS}
    [/side]

    # Drakes
    # Glider caste
    # same one from S4 (since he ran)
    [side]
        side=3
        controller=ai
        id="Veralon"
        name= _ "Veralon"
        [modifications]
            {TRAIT_RESILIENT}
            {TRAIT_STRONG}
        [/modifications]
        type="Drake Ranger"
        unrenamable=yes
        {DRAKES_SAURIANS_KERGEOM}
        {FLAG_VARIANT long}
        team_name=drakes
        user_team_name= _ "Drakes"
        {GOLD 80 110 140}
        {INCOME 10 14 16}
        recruit="Drake Glider, Drake Adventurer, Sky Drake"
        {LAWFUL_AI_PARAMS}
    [/side]

    # orcs
    # clan bloodrock
    [side]
        side=4
        controller=ai
        {WHITE_FANG_ORCS}
        {FLAG_VARIANT6 ragged}
        team_name="orcs4"
        user_team_name= _ "Whitefang Orcs"
        type=Orcish Slurbow
        canrecruit=yes

        {GOLD 400 600 800}
        {QUANTITY recruit ("Orcish Warrior,Orcish Crossbowman,Goblin Knight,Orcish Grunt,Orcish Archer,Goblin Impaler,Young Ogre,Ogre") ("Orcish Warrior,Orcish Crossbowman,Orcish Slurbow,Goblin Knight,Orcish Grunt,Orcish Archer,Goblin Impaler,Ogre,YOung Ogre") ("Orcish Warrior,Orcish Warlord,Orcish Crossbowman,Orcish Slurbow,Goblin Knight,Orcish Grunt,Orcish Archer,Goblin Impaler,Direwolf Rider,Ogre,Young Ogre")}
        [modifications]
            {TRAIT_QUICK}
            {TRAIT_RESILIENT}
        [/modifications]
        {CHAOTIC_AI_PARAMS}
    [/unit]

    # Drakes
    # Fighter and Clashers
    # same one from S4 (since he ran)
    [side]
        side=5
        controller=ai
        id="Marra Di’lek"
        name= _ "Marra Di’lek"
        [modifications]
            {TRAIT_STRONG}
            {TRAIT_RESILIENT}
            {SNOWFOOT_BUFF}
        [/modifications]
        type="Drake Subjugator"
        unrenamable=yes
        {DRAKES_SAURIANS_KERGEOM}
        {FLAG_VARIANT long}
        team_name=drakes
        user_team_name= _ "Drakes"
        {GOLD 100 120 150}
        {INCOME 10 14 16}
        recruit="Drake Fighter,Drake Warrior,Drake Smasher,Drake Clasher,Drake Thrasher,Drake Arbiter"
        # villages grant no extra income
        village_gold=0
        village_support={ON_DIFFICULTY 4 6 8}
        {LAWFUL_AI_PARAMS}
    [/side]

    # orcs
    # snowfoot clan
    [side]
        side=6
        controller=ai
        type=Orcish Warlord
        canrecruit=yes
        [modifications]
            # i added intelligent this one's smart enough
            # to make his tribe wear snow shoes for better defense
            {TRAIT_INTELLIGENT}
            {TRAIT_STRONG}
            {SNOWFOOT_BUFF}
        [/modifications]
        
        team_name="orcs3"
        user_team_name=_"Snowfoot Clan"
        color=lightblue
        {FLAG_VARIANT6 ragged}

        recruit="Orcish Warrior,Orcish Crossbowman,Goblin Knight,Orcish Grunt,Orcish Warlord,Orcish Slurbow,Orcish Archer"
        {CHAOTIC_AI_PARAMS}
    [/side]

    # Drakes
    # Fighters and Burners
    [side]
        side=7
        controller=ai
        # yes, I couldn't just scrap him off
        # here, in this iteration, he is
        # one of Kergeom's top brass
        id="Krash Verath"
        name= _ "Krash Verath"
        description= _ "The Fireclaw"
        [modifications]
            {TRAIT_FEARLESS}
            {TRAIT_RESILIENT}
            [object]
                silent=yes
                id="drake_krash_buff"
                [effect]
                    apply_to=attack
                    range=melee
                    set_type=fire
                    [set_specials]
                        mode=append
                        [heal_on_hit]
                            id=rageheal
                            name=_"rageheal"
                            name_inactive=_"rageheal"
                            description=_"This unit heals 6 HP when this attack does damage"
                            description_inactive=_"This unit heals 6 HP when this attack does damage"
                            special_note= _ "Heals 6 HP if this unit lands a hit"
                            value=6
                        [/heal_on_hit]
                    [/set_specials]
                [/effect]
            [/object]
            {SNOWFOOT_BUFF}
        [/modifications]
        type="Drake Blademaster"
        unrenamable=yes
        {DRAKES_SAURIANS_KERGEOM}
        {FLAG_VARIANT long}
        team_name=drakes
        user_team_name= _ "Drakes"
        {GOLD 100 120 150}
        {INCOME 10 14 16}
        recruit="Drake Fighter,Drake Warrior,Drake Blademaster,Drake Burner,Fire Drake"
        # villages grant no extra income
        village_gold=0
        village_support={ON_DIFFICULTY 4 6 8}
        {LAWFUL_AI_PARAMS}
    [/side]

    # orcs
    # clan embershard
    # useless vs drakes
    [side]
        side=8
        controller=ai
        {EMBERSHARD_ORCS}
        {FLAG_VARIANT6 ragged}
        team_name="orcs2"
        user_team_name= _ "Embershard Orcs"
        type=Orcish Slurbow
        [modifications]
            {TRAIT_RESILIENT}
            {TRAIT_STRONG}
            {CLAN_EMBERSHARD_BUFF}
        [/modifications]
        canrecruit=yes

        {GOLD 700 850 1000}
        {INCOME 22 26 30}

        recruit="Orcish Archer,Orcish Crossbowman,Orcish Slurbow,Goblin Pillager,Goblin Torcher,Goblin Arsonist,Goblin Incendiary"
        {CHAOTIC_AI_PARAMS}
    [/side]

    # orcs
    # clan bloodrock
    [side]
        side=9
        controller=ai
        {BLOODROCK_ORCS}
        {FLAG_VARIANT6 ragged}
        team_name="orcs1"
        user_team_name= _ "Bloodrock Orcs"
        type=Orcish Sovereign
        canrecruit=yes

        {GOLD 700 850 1000}
        {INCOME 22 26 30}
        {QUANTITY recruit ("Orcish Warrior,Orcish Crossbowman,Goblin Knight,Orcish Grunt,Orcish Archer,Goblin Impaler") ("Orcish Warrior,Orcish Crossbowman,Orcish Slurbow,Goblin Knight,Orcish Grunt,Orcish Archer,Goblin Impaler") ("Orcish Warrior,Orcish Warlord,Orcish Crossbowman,Orcish Slurbow,Goblin Knight,Orcish Grunt,Orcish Archer,Goblin Impaler,Direwolf Rider")}
        [modifications]
            {CLAN_BLOODROCK_BUFF}
            {TRAIT_STRONG}
            {TRAIT_FEARLESS}
        [/modifications]
        {CHAOTIC_AI_PARAMS}
    [/side]

    # main drakes side
    [side]
        side=10
        controller=ai
        location_id=Player_10_start
        id="Mar_Ildian"
        name= _ "Lord Mar’Ildian"
        unit_description= _ "Vassal of Kergeom"
        type=Armageddon Drake
        [modifications]
            {TRAIT_RESILIENT}
            {TRAIT_DEXTROUS}
            {SNOWFOOT_BUFF}
        [/modifications]
        unrenamable=yes
        {DRAKES_SAURIANS_KERGEOM}
        {FLAG_VARIANT long}
        team_name=drakes
        user_team_name= _ "Drakes"
        shroud=no
        fog=no
        share_vision=none
        {GOLD 400 560 800}
        {INCOME 22 28 36}
        recruit="Drake Burner, Drake Fighter, Drake Clasher, Drake Flameheart, Fire Drake, Drake Warrior, Drake Thrasher, Drake Arbiter, Drake Blademaster, Inferno Drake"
        # villages grant no extra income
        village_gold=0
        village_support={ON_DIFFICULTY 4 6 8}
        {LAWFUL_AI_PARAMS}
    [/side]

    # prestart
    [event]
        name=prestart

        {RECALL "Aiglondur"}
        {RECALL_LOYALS}

        {KNALGAN_ALLIANCE_RECALL_FLYING}

        # recall withervein clan
        [unstore_unit]
            variable=stored_zorfu_var
            x,y=21,51
            find_vacant=no
        [/unstore_unit]

        [foreach]
            array=stored_clan_withervein
            variable=clan_member
            [do]
                [unstore_unit]
                    variable=stored_clan_withervein[$i]
                    x,y=21,51
                    find_vacant=yes
                [/unstore_unit]
            [/do]
        [/foreach]

        {CLEAR_VARIABLE stored_zorfu_var,stored_clan_withervein}

        # objectives
        [objectives]
            side=1
            silent=no

            [objective]
                # the classic scenario
                description= _ "Defeat all enemy leaders"
                condition="win"
            [/objective]

            [objective]
                description= _ "Death of Tallin"
                condition="lose"
            [/objective]
            [objective]
                description= _ "Death of Zorfu"
                condition="lose"
            [/objective]

            {TURNS_RUN_OUT}

            [gold_carryover]
                carryover_percentage=40
                bonus=yes
            [/gold_carryover]
            # spoonfeed players instructions since they are duds
            # and incapable of thinking out of the box
            # (dont judge me, your feedback of my previous UMC led me to this)
            [note]
                description= _ "Right-Click Menu commands to control Zorfu are available"
            [/note]
            # note to clarify that drakes have higher defence and lower MP cost here
            [note]
                description= _ "These drakes are more adapted to the snowy terrain"
            [/note]
            [note]
                description= _ "Each orc clan has a different trait/ability"
            [/note]
            # offer incentive for poachers and trappers
            [note]
                description= _ "The Poacher unit tree gains a special buff in this scenario"
            [/note]
        [/objectives]

        # make Tallin wear snow boots
        [object]
            silent=yes
            [filter]
                id="Tallin"
            [/filter]
            [effect]
                apply_to=movement_costs
                replace=yes
                [movement_costs]
                    frozen=2
                [/movement_costs]
            [/effect]
            [effect]
                apply_to=defense
                replace=yes
                [defense]
                    frozen=60
                [/defense]
            [/effect]
        [/object]

        # aiglondur and Angras have stayed at Kal Kartha
        # sorting things out
        # as well as all your dwarves (except scouts)
        [store_unit]
            [filter]
                id="Aiglondur"
            [/filter]
            variable=stored_Aiglondur_var
            kill=yes
        [/store_unit]
        [store_unit]
            [filter]
                id="Angras"
            [/filter]
            variable=stored_Angras_var
            kill=yes
        [/store_unit]
    [/event]

    # add after prestart event so that Zorfu's ID
    # shows up in it
    {AI_CONTROLLER_ALLOW_MOVEMENT_CONTROL Zorfu 2}
    
    # give drakes an edge
    [event]
        name=recruit,unit_placed
        first_time_only=no
        [filter]
            race=drake
            side=5,7,10
        [/filter]
        {SNOWFOOT_BUFF}
    [/event]

    # give bloodrock orcs their trait
    [event]
        name=recruit,unit_placed
        first_time_only=no
        [filter]
            race=orc,wolf,goblin
            side=9
        [/filter]
        {CLAN_BLOODROCK_BUFF}
    [/event]

    # give embershard clan their trait
    [event]
        name=recruit,unit_placed
        first_time_only=no
        [filter]
            race=orc,wolf,goblin
            side=9
        [/filter]
        {CLAN_EMBERSHARD_BUFF}
    [/event]

    # give clan snowfoot some special
    [event]
        name=recruit,unit_placed
        first_time_only=no
        [filter]
            side=6
        [/filter]
        {SNOWFOOT_BUFF}
    [/event]

    # give poacher line buff
    [event]
        name=recall,recruit,unit_placed
        first_time_only=no
        [filter]
            side=1
            type_adv_tree=Poacher
        [/filter]
        {SNOWFOOT_BUFF}
    [/event]

    # enemies defeated event
    [event]
        name=enemies defeated

        # some dialogue

        # clear the enchanting vars
        {NRR_CLEAR_ENCHANTS_VARS 1}

        {ENDLEVEL_VICTORY 40 yes}
    [/event]

    # timeover event
    [event]
        name=time over

        {ENDLEVEL_DEFEAT}
    [/event]

    # Setting: snowy hills near kal kartha
    # Huge bloodbath of orcs and drakes including Zorfu
    {HERO_DEATH_EVENTS}
[/scenario]
