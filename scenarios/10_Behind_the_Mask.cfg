#textdomain wesnoth-nrr

[scenario]
    id=10_Behind_the_Mask
    name= _ "Behind the Mask"
    map_file=10_Behind_the_Mask.map

    # no turn limit here
    # scenario ends either by you nabbing the dwarf official
    # or the official escaping

    turns=unlimited
    next_scenario=10x_The_Stratagem
    victory_when_enemies_defeated=no
    {XP_MODIFIER_NRR}
    {NRR_LOAD_RESOURCES}
    {ENABLE_DWARVISH_RUNESMITH}
    {NRR_ENCHANTING_SYSTEM}

    {DEFAULT_MUSIC_PLAYLIST}
    {DEFAULT_SCHEDULE_DUSK}

    [side]
        side=1
        controller=human
        {CHARACTER_STATS_TALLIN}
        {FLAG_VARIANT knalgan}
        team_name="player"
        user_team_name= _ "Knalgan Alliance"
        shroud=yes
        fog=yes
        share_vision=all
        {GOLD 260 240 220}
        {INCOME 4 3 3}
        village_gold=0
        # you probably will not be sinking
        # into negative gold
        # not that it matters here anyway
        village_support={ON_DIFFICULTY 5 4 4}
        recruit={KNALGAN_ALLIANCE_RECRUIT_LIST_FULL}
    [/side]

    {STARTING_VILLAGES 1 3}

    [side]
        side=2
        controller=ai
        persistent=yes
        save_id=Zorfu
        {WITHERVEIN_ORCS}
        {CHARACTER_STATS_ZORFU}
        {FLAG_VARIANT6 ragged}
        team_name="player"
        user_team_name= _ "Withervein Orcs"
        shroud=yes
        fog=yes
        share_vision=all

        {GOLD 300 280 260}
        {INCOME 4 3 3}
        village_gold={ON_DIFFICULTY 1 1 1}
        village_support={ON_DIFFICULTY 4 3 3}

        recruit={ORC_CLAN_WITHERVEIN_RECRUIT_LIST}
        {CHAOTIC_AI_PARAMS}
    [/side]

    {STARTING_VILLAGES 2 3}

    {AI_CONTROLLER_ALLOW_MOVEMENT_CONTROL Zorfu 2}

    # main masked dwarf side
    [side]
        side=3
        controller=ai

        {NO_RECRUITMENT}

        {NO_ECONOMY}

        {KARRAG_LOYALISTS}
        {FLAG_VARIANT knalgan}
        team_name=karrag
        user_team_name= _ "Kal Kartha"
        {HIDDEN_TEAM}

        type=Dwarvish Masked Lord
        id=Movrur
        name= _ "Masked Dwarf"
        [modifications]
            {TRAIT_HEALTHY}
            {TRAIT_STRONG}
        [/modifications]
        profile=portraits/maskeddwarf3.png~RIGHT()
        canrecruit=yes

        facing=se

        {NEUTRAL_AI_PARAMS}
    [/side]

    # side leaders
    # for masked dwarves
    # sides 4-8
    [side]
        side=4
        controller=ai

        recruit={KAL_KARTHA_MASKED_DWARVES_VETERANS}

        {GOLD 50 60 70}
        {INCOME 8 11 14}

        {KARRAG_LOYALISTS}
        {FLAG_VARIANT knalgan}
        team_name=karrag
        user_team_name= _ "Kal Kartha"

        type=Dwarvish Masked Lord
        id=Nardrus
        random_traits=yes
        name= _ "Masked Dwarf"
        profile=portraits/maskeddwarf3.png~RIGHT()
        canrecruit=yes

        facing=sw

        {NEUTRAL_AI_PARAMS}
    [/side]

    {STARTING_VILLAGES 4 6}

    [side]
        side=5
        controller=ai

        recruit={KAL_KARTHA_MASKED_DWARVES}

        {GOLD 50 60 70}
        {INCOME 8 11 14}

        {KARRAG_LOYALISTS}
        {FLAG_VARIANT knalgan}
        team_name=karrag
        user_team_name= _ "Kal Kartha"

        type=Dwarvish Masked Berserker
        id=Pelatsil
        name= _ "Masked Dwarf"
        random_traits=yes
        profile=portraits/maskeddwarf3.png~RIGHT()
        canrecruit=yes

        facing=se

        {NEUTRAL_AI_PARAMS}
    [/side]

    {STARTING_VILLAGES 5 4}

    [side]
        side=6
        controller=ai

        recruit={KAL_KARTHA_MASKED_DWARVES_VETERANS}

        {GOLD 50 60 70}
        {INCOME 8 11 14}

        {KARRAG_LOYALISTS}
        {FLAG_VARIANT knalgan}
        team_name=karrag
        user_team_name= _ "Kal Kartha"

        type=Dwarvish Masked Dragonguard
        id=Trithcatlos
        name= _ "Masked Dwarf"
        random_traits=yes
        profile=portraits/maskeddwarf3.png~RIGHT()
        canrecruit=yes

        facing=sw

        {NEUTRAL_AI_PARAMS}
    [/side]

    {STARTING_VILLAGES 6 4}

    [side]
        side=7
        controller=ai

        recruit={KAL_KARTHA_MASKED_DWARVES_VETERANS}

        {GOLD 50 60 70}
        {INCOME 8 11 14}

        {KARRAG_LOYALISTS}
        {FLAG_VARIANT knalgan}
        team_name=karrag
        user_team_name= _ "Kal Kartha"

        type=Dwarvish Masked Sentinel
        id=Gomdris
        name= _ "Masked Dwarf"
        random_traits=yes
        profile=portraits/maskeddwarf3.png~RIGHT()
        canrecruit=yes

        facing=sw

        {NEUTRAL_AI_PARAMS}
    [/side]

    {STARTING_VILLAGES 7 4}

    [side]
        side=8
        controller=ai

        recruit={KAL_KARTHA_MASKED_DWARVES_VETERANS}

        {GOLD 50 60 70}
        {INCOME 8 11 14}

        {KARRAG_LOYALISTS}
        {FLAG_VARIANT knalgan}
        team_name=karrag
        user_team_name= _ "Kal Kartha"
        random_traits=yes

        type=Dwarvish Masked Dragonguard
        id=Glamalil
        name= _ "Masked Dwarf"
        profile=portraits/maskeddwarf3.png~RIGHT()
        canrecruit=yes

        facing=sw

        {NEUTRAL_AI_PARAMS}
    [/side]

    {STARTING_VILLAGES 8 4}

    # allied side 
    # gryphon backup
    [side]
        side=9
        controller=ai
        no_leader=yes
        {FLAG_VARIANT long}
        team_name=player,monsters
        user_team_name= _ "Gryphons"
        {MONSTER_SIDE}
        shroud=yes
        fog=yes
        share_vision=all
        
        # we do not let player know they are 
        # getting some backup here
        {HIDDEN_TEAM}
        {NO_ECONOMY}
        {NO_RECRUITMENT}

        {NEUTRAL_AI_PARAMS}
    [/side]

    # monster side
    # roaming monsters
    [side]
        side=10
        controller=ai
        team_name=monsters
        user_team_name= _ "Monsters"
        {HIDDEN_TEAM}
        {FLAG_VARIANT6 ragged}
        {MONSTER_SIDE}
        no_leader=yes
        {NO_ECONOMY}
        {NO_RECRUITMENT}
        # {CHAOTIC_AI_PARAMS}
        [ai]
            village_value=0
            [avoid]
                terrain=*^V*
            [/avoid]
        [/ai]
    [/side]

    # shrooms
    # allied with monsters and karrag
    # since we dont want masked dwarves to get hindered here
    [side]
        side=11
        controller=ai
        team_name=monsters,karrag
        user_team_name= _ "Monsters"
        {HIDDEN_TEAM}
        {FLAG_VARIANT6 ragged}
        {MONSTER_SIDE}
        no_leader=yes
        {NO_ECONOMY}
        {NO_RECRUITMENT}
        # {CHAOTIC_AI_PARAMS}
        [ai]
            village_value=0
            [avoid]
                terrain=*^V*
            [/avoid]
        [/ai]
    [/side]

    [event]
        name=prestart

        {RECALL "Aiglondur"}
        {RECALL_LOYALS}

        # make atmosphere omnious
        {COLOR_ADJUST -25 -25 -25}

        # adjust some positions
        {TELEPORT_UNIT (id="Tallin") 31 67}
        {TELEPORT_UNIT (id="Aiglondur") 34 69}
        {TELEPORT_UNIT (id="Angras") 28 68}

        # recall a free rider/master
        # you're welcome, btw
        {KNALGAN_ALLIANCE_RECALL_FLYING}

        # objectives
        [objectives]
            side=1
            silent=no
            [objective]
                caption= _ "Primary Objective:"
                description= _ "Capture the Masked Dwarf Official"
                condition=win
            [/objective]
            [objective]
                {BONUS_OBJECTIVE_CAPTION}
                description= _ "Destroy Prisoner Caravans"
                condition=win
            [/objective]


            [objective]
                description= _ "Death of Tallin"
                condition="lose"
            [/objective]
            [objective]
                description= _ "Death of Aiglondur"
                condition="lose"
            [/objective]
            [objective]
                description= _ "Death of Angras"
                condition="lose"
            [/objective]
            [objective]
                description= _ "Death of Zorfu"
                condition="lose"
            [/objective]

            # allow player to go all out
            [gold_carryover]
                carryover_percentage=20
                bonus=no
            [/gold_carryover]

            [note]
                description= _ "Right-Click Tallin to view Enchanting Help"
            [/note]
            [note]
                description= _ "Right-Click Angras to view Rune Descriptions"
            [/note]
            [note]
                description= _ "Right-Click Menu commands to control Zorfu are available"
            [/note]
            [note]
                description= _ "Avoid attacking Shrooms"
            [/note]
            # offer some incentive
            [note]
                description= _ "Prisoner Carts might have allied units inside."
            [/note]

            {HAS_NO_TURN_LIMIT}
        [/objectives]

        # optimise AI
        {FAST_MAI_ADD 4}
        {FAST_MAI_ADD 5}
        {FAST_MAI_ADD 6}
        {FAST_MAI_ADD 7}
        {FAST_MAI_ADD 8}

        # spawn units of side 3

        # caravans
        {LOYAL_UNIT 3 "Prisoner Caravan" 20 63}{ASSIGN_ID cart01}
        {LOYAL_UNIT 3 "Prisoner Caravan" 22 63}{ASSIGN_ID cart02}
        {LOYAL_UNIT 3 "Prisoner Caravan" 21 64}{ASSIGN_ID cart03}

        # guard units
        # varies by difficulty: 15/18/21
        {LOYAL_UNIT 3 {ON_DIFFICULTY "Dwarvish Masked Stalwart" "Dwarvish Masked Sentinel" "Dwarvish Masked Sentinel"} 21 66}
        {LOYAL_UNIT 3 {ON_DIFFICULTY "Dwarvish Masked Berserker" "Dwarvish Masked Berserker" "Dwarvish Masked Berserker"} 21 66}
        {LOYAL_UNIT 3 {ON_DIFFICULTY "Dwarvish Masked Ulfserker" "Dwarvish Masked Berserker" "Dwarvish Masked Berserker"} 21 66}
        {LOYAL_UNIT 3 {ON_DIFFICULTY "Dwarvish Masked Ulfserker" "Dwarvish Masked Berserker" "Dwarvish Masked Berserker"} 21 66}
        {LOYAL_UNIT 3 {ON_DIFFICULTY "Dwarvish Masked Guardsman" "Dwarvish Masked Guardsman" "Dwarvish Masked Stalwart"} 21 66}

        #ifdef NORMAL
        {LOYAL_UNIT 3 {ON_DIFFICULTY "Dwarvish Masked Thunderer" "Dwarvish Masked Thunderer" "Dwarvish Masked Thunderguard"} 21 66}
        #endif
        #ifdef HARD
        {LOYAL_UNIT 3 {ON_DIFFICULTY "Dwarvish Masked Thunderer" "Dwarvish Masked Thunderer" "Dwarvish Masked Thunderguard"} 21 66}
        {LOYAL_UNIT 3 {ON_DIFFICULTY "Dwarvish Masked Thunderer" "Dwarvish Masked Thunderer" "Dwarvish Masked Thunderguard"} 21 66}
        #endif        

        {LOYAL_UNIT 3 {ON_DIFFICULTY "Dwarvish Masked Stalwart" "Dwarvish Masked Sentinel" "Dwarvish Masked Sentinel"} 24 64}
        {LOYAL_UNIT 3 {ON_DIFFICULTY "Dwarvish Masked Berserker" "Dwarvish Masked Berserker" "Dwarvish Masked Berserker"} 24 64}
        {LOYAL_UNIT 3 {ON_DIFFICULTY "Dwarvish Masked Ulfserker" "Dwarvish Masked Berserker" "Dwarvish Masked Berserker"} 24 64}
        {LOYAL_UNIT 3 {ON_DIFFICULTY "Dwarvish Masked Ulfserker" "Dwarvish Masked Berserker" "Dwarvish Masked Berserker"} 24 64}
        {LOYAL_UNIT 3 {ON_DIFFICULTY "Dwarvish Masked Guardsman" "Dwarvish Masked Guardsman" "Dwarvish Masked Stalwart"} 24 64}

        #ifdef NORMAL
        {LOYAL_UNIT 3 {ON_DIFFICULTY "Dwarvish Masked Thunderer" "Dwarvish Masked Thunderer" "Dwarvish Masked Thunderguard"} 24 64}
        #endif
        #ifdef HARD
        {LOYAL_UNIT 3 {ON_DIFFICULTY "Dwarvish Masked Thunderer" "Dwarvish Masked Thunderer" "Dwarvish Masked Thunderguard"} 24 64}
        {LOYAL_UNIT 3 {ON_DIFFICULTY "Dwarvish Masked Thunderer" "Dwarvish Masked Thunderer" "Dwarvish Masked Thunderguard"} 24 64}
        #endif  

        {LOYAL_UNIT 3 {ON_DIFFICULTY "Dwarvish Masked Stalwart" "Dwarvish Masked Sentinel" "Dwarvish Masked Sentinel"} 17 65}
        {LOYAL_UNIT 3 {ON_DIFFICULTY "Dwarvish Masked Berserker" "Dwarvish Masked Berserker" "Dwarvish Masked Berserker"} 17 65}
        {LOYAL_UNIT 3 {ON_DIFFICULTY "Dwarvish Masked Ulfserker" "Dwarvish Masked Berserker" "Dwarvish Masked Berserker"} 17 65}
        {LOYAL_UNIT 3 {ON_DIFFICULTY "Dwarvish Masked Ulfserker" "Dwarvish Masked Berserker" "Dwarvish Masked Berserker"} 17 65}
        {LOYAL_UNIT 3 {ON_DIFFICULTY "Dwarvish Masked Guardsman" "Dwarvish Masked Guardsman" "Dwarvish Masked Stalwart"} 17 65}

        #ifdef NORMAL
        {LOYAL_UNIT 3 {ON_DIFFICULTY "Dwarvish Masked Thunderer" "Dwarvish Masked Thunderer" "Dwarvish Masked Thunderguard"} 17 65}
        #endif
        #ifdef HARD
        {LOYAL_UNIT 3 {ON_DIFFICULTY "Dwarvish Masked Thunderer" "Dwarvish Masked Thunderer" "Dwarvish Masked Thunderguard"} 17 65}
        {LOYAL_UNIT 3 {ON_DIFFICULTY "Dwarvish Masked Thunderer" "Dwarvish Masked Thunderer" "Dwarvish Masked Thunderguard"} 17 65}
        #endif

        # prepare MAI
        # for Movrur
        [micro_ai]
            side=3
            ai_type=messenger_escort
            action=add

            [filter]
                id=Movrur
            [/filter]
            # designate a well-defined path
            # do not just give the final coordinates or the scenario becomes
            # amazingly horrendous
            waypoint_x=21,28,33,32,29,22,15, 8, 9,16,22,28,30,24,18,12,14,19,26,30,24,18,11, 9,13,19,25,31,35
            waypoint_y=59,57,56,50,47,49,49,49,44,41,39,37,33,31,32,30,25,25,24,20,17,17,19,15,10, 9, 8, 5, 2
            ca_score=450000
        [/micro_ai]

        # and his carts
        [micro_ai]
            side=3
            ai_type=messenger_escort
            action=add

            [filter]
                id=cart01
            [/filter]
            # designate a well-defined path
            # do not just give the final coordinates or the scenario becomes
            # amazingly horrendous
            waypoint_x=21,28,33,32,29,22,15, 8, 9,16,22,28,30,24,18,12,14,19,26,30,24,18,11, 9,13,19,25,31,35
            waypoint_y=59,57,56,50,47,49,49,49,44,41,39,37,33,31,32,30,25,25,24,20,17,17,19,15,10, 9, 8, 5, 2
            ca_score=450000
        [/micro_ai]
        [micro_ai]
            side=3
            ai_type=messenger_escort
            action=add

            [filter]
                id=cart02
            [/filter]
            # designate a well-defined path
            # do not just give the final coordinates or the scenario becomes
            # amazingly horrendous
            waypoint_x=21,28,33,32,29,22,15, 8, 9,16,22,28,30,24,18,12,14,19,26,30,24,18,11, 9,13,19,25,31,35
            waypoint_y=59,57,56,50,47,49,49,49,44,41,39,37,33,31,32,30,25,25,24,20,17,17,19,15,10, 9, 8, 5, 2
            ca_score=300000
        [/micro_ai]
        [micro_ai]
            side=3
            ai_type=messenger_escort
            action=add

            [filter]
                id=cart03
            [/filter]
            # designate a well-defined path
            # do not just give the final coordinates or the scenario becomes
            # amazingly horrendous
            waypoint_x=21,28,33,32,29,22,15, 8, 9,16,22,28,30,24,18,12,14,19,26,30,24,18,11, 9,13,19,25,31,35
            waypoint_y=59,57,56,50,47,49,49,49,44,41,39,37,33,31,32,30,25,25,24,20,17,17,19,15,10, 9, 8, 5, 2
            ca_score=300000
        [/micro_ai]

        # place side 4 units
        {LOYAL_UNIT 4 "Dwarvish Masked Ulfserker" 8 65}{GUARDIAN}
        {LOYAL_UNIT 4 "Dwarvish Masked Ulfserker" 6 66}{GUARDIAN}

        {LOYAL_UNIT 4 "Dwarvish Masked Stalwart"  8 11}{GUARDIAN}
        {LOYAL_UNIT 4 "Dwarvish Masked Stalwart" 11 13}{GUARDIAN}
        {LOYAL_UNIT 4 "Dwarvish Masked Stalwart" 18  7}{GUARDIAN}
        {LOYAL_UNIT 4 "Dwarvish Masked Stalwart" 20 10}{GUARDIAN}

        {LOYAL_UNIT 4 "Dwarvish Masked Stalwart" 10 28}{GUARDIAN}
        {LOYAL_UNIT 4 "Dwarvish Masked Stalwart" 13 28}{GUARDIAN}
        {LOYAL_UNIT 4 "Dwarvish Masked Stalwart" 28 20}{GUARDIAN}
        {LOYAL_UNIT 4 "Dwarvish Masked Stalwart" 30 18}{GUARDIAN}

        {LOYAL_UNIT 4 "Dwarvish Masked Stalwart"  7 48}{GUARDIAN}
        {LOYAL_UNIT 4 "Dwarvish Masked Stalwart" 10 48}{GUARDIAN}

        {LOYAL_UNIT 4 "Dwarvish Masked Stalwart" 16 59}{GUARDIAN}

        #thunderguards
        {LOYAL_UNIT 4 "Dwarvish Masked Thunderguard" 28 30}{GUARDIAN}
        {LOYAL_UNIT 4 "Dwarvish Masked Thunderguard" 28 34}{GUARDIAN}
        {LOYAL_UNIT 4 "Dwarvish Masked Thunderguard" 31 37}{GUARDIAN}
        {LOYAL_UNIT 4 "Dwarvish Masked Thunderguard" 34 33}{GUARDIAN}

        {LOYAL_UNIT 4 "Dwarvish Masked Thunderguard" 31 55}{GUARDIAN}
        {LOYAL_UNIT 4 "Dwarvish Masked Thunderguard" 19 58}{GUARDIAN}

        {LOYAL_UNIT 4 "Dwarvish Masked Guardsman" 22 57}{GUARDIAN}
        {LOYAL_UNIT 4 "Dwarvish Masked Guardsman" 30 51}{GUARDIAN}

        {LOYAL_UNIT 4 "Dwarvish Masked Guardsman" 29 49}{GUARDIAN}
        {LOYAL_UNIT 4 "Dwarvish Masked Guardsman" 27 50}{GUARDIAN}

        {LOYAL_UNIT 4 "Dwarvish Masked Guardsman" 28 48}{GUARDIAN}

        {LOYAL_UNIT 4 "Dwarvish Masked Guardsman"  9 51}{GUARDIAN}
        {LOYAL_UNIT 4 "Dwarvish Masked Guardsman" 13 51}{GUARDIAN}

        {LOYAL_UNIT 4 "Dwarvish Masked Guardsman" 16 50}{GUARDIAN}
        {LOYAL_UNIT 4 "Dwarvish Masked Guardsman" 19 48}{GUARDIAN}

        {LOYAL_UNIT 4 "Dwarvish Masked Guardsman" 20 51}{GUARDIAN}
        {LOYAL_UNIT 4 "Dwarvish Masked Guardsman" 23 51}{GUARDIAN}

        {LOYAL_UNIT 4 "Dwarvish Masked Guardsman" 25 23}{GUARDIAN}
        {LOYAL_UNIT 4 "Dwarvish Masked Guardsman" 17 26}{GUARDIAN}
        {LOYAL_UNIT 4 "Dwarvish Masked Guardsman" 18 26}{GUARDIAN}
        {LOYAL_UNIT 4 "Dwarvish Masked Guardsman" 24 22}{GUARDIAN}

        # spawn monsters
        {GENERIC_UNIT 10 {ON_DIFFICULTY "Troll" "Troll" "Troll Warrior"} 5 7}
        {GENERIC_UNIT 10 {ON_DIFFICULTY "Troll" "Troll Warrior" "Troll Warrior"} 9 4}
        {GENERIC_UNIT 10 "Troll Shaman" 8 6}
        {GENERIC_UNIT 10 "Troll Rocklobber" 7 9}

        {GENERIC_UNIT 10 "Troll Hero" 6 5}

        {RANDOM_SPAWN 10 ("Lesser Earth Daemon,Earth Daemon,Greater Earth Daemon") 7 6}
        {RANDOM_SPAWN 10 ("Lesser Earth Daemon,Earth Daemon,Greater Earth Daemon") 8 3}
        {RANDOM_SPAWN 10 ("Lesser Earth Daemon,Earth Daemon,Greater Earth Daemon") 4 7}

        # shrooms
        {SCATTER_UNITS {ON_DIFFICULTY 30 35 40} ("Shroom, Elder Shroom, Elder Shroom, Elder Shroom, Ancient Shroom, Ancient Shroom") 3 (
            {EVERYWHERE}
            terrain=*^Tf*

            [not]
                [filter]
                [/filter]
            [/not]

            [not]
                [filter_adjacent_location]
                    [filter]
                    [/filter]
                [/filter_adjacent_location]
            [/not]
        ) (
            side=11
            generate_name=yes
            random_traits=yes
            ai_special=guardian
            upkeep=0
        )}

        
    [/event]

    # clan withervein buffing
    # has to be done specifically for
    # orcish unit types
    # and goblins
    # wolf race units do not count 
    # (how are you gonna give poison to its bite? the wolf would die instead)
    [event]
        name=unit placed
        first_time_only=no
        # counts like 9 units here
        [filter]
            side=2
            type_adv_tree=Orcish Grunt,Orcish Archer,Goblin Spearman
        [/filter]

        [object]
            silent=yes
            duration=forever
            [filter]
                x,y=$x1,$y1
            [/filter]

            [effect]
                apply_to=new_ability
                [abilities]
                    {ABILITY_WITHERVEIN}
                [/abilities]
            [/effect]
            [effect]
                apply_to=attack
                range=melee
                [set_specials]
                    mode=append
                    {WEAPON_SPECIAL_POISON}
                    {WEAPON_SPECIAL_SLOW}
                [/set_specials]
            [/effect]
        [/object]
    [/event]
    [event]
        name=unit placed
        first_time_only=no
        # seperate script for the Assassin/slayer/nightblade
        [filter]
            side=2
            type_adv_tree=Orcish Assassin
        [/filter]

        [object]
            silent=yes
            duration=forever
            [filter]
                x,y=$x1,$y1
            [/filter]

            [effect]
                apply_to=new_ability
                [abilities]
                    {ABILITY_WITHERVEIN}
                [/abilities]
            [/effect]
            [effect]
                apply_to=attack
                range=melee
                type=blade
                [set_specials]
                    mode=append
                    {WEAPON_SPECIAL_POISON}
                    {WEAPON_SPECIAL_SLOW}
                [/set_specials]
            [/effect]
        [/object]
    [/event]

    # do not let AI ally deprive player of income
    [event]
        name="capture"
        first_time_only=no
        [filter]
            side=2
        [/filter]

        # check if side 1 owns this village
        [filter_condition]
            {VARIABLE_CONDITIONAL owner_side numerical_equals 1}
        [/filter_condition]

        # return it back if true
        [capture_village]
            side=1
            x,y=$x1,$y1
        [/capture_village]
    [/event]

    # flavor
    {RENAME_MASKED_DWARVES 3,4,5,6,7,8}

    # grimoire page pickup event
    {PLACE_IMAGE "items/book2.png" 12 59}

    [event]
        name="moveto"
        first_time_only=yes
        [filter]
            id="Tallin"
            x,y=12,59
        [/filter]

        {REMOVE_IMAGE 12 59}

        # some dialogue from the book
        # about "more powa!"

        {VARIABLE_OP pages_found add 1}
    [/event]

    # set up a trap
    # can also be used by player to win this level
    # if timed right
    [event]
        name=capture
        first_time_only=yes

        [filter]
            side=1,2
            x,y=10,9
        [/filter]

        {EARTHQUAKE (
            [terrain]
                x=9,10
                y=9,8
                terrain=Uu
            [/terrain]
        )}
    [/event]
    
    # Setting: near Kal Kartha
    # Tallin and co ambush a high ranking mask dwarf lord whom they have encountered before and defeat him to reveal Karrag's location
    {HERO_DEATH_EVENTS}
    {KAAYYE_DEATH_EVENT}
[/scenario]
